<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carros: Cadastro</title>
    <link rel="stylesheet" href="css/cadastro.css">
    <link rel="stylesheet" href="css/global.css">
</head>

<body>
    <div class="container">
        <div class="card_erro" id="cardErro">
            <span id="mensagem_erro"></span>
        </div>
        <div class="cont_conteudo">
            <div class="cont_cadastro">
                <div class="cont_voltar_titulo">
                    <a href="index.html" class="voltar">
                        <img class="" src="assets/icon/icons_setaEsquerda.png" alt="">
                    </a>
                    <p class="titulo_cadastro fontRed titulo fontBlack boldMedio">Cadastro</p>
                </div>
                <div class="cont_inputs">
                    <label class="fontRed boldMedio descricao" for="input_nome">Nome</label>
                    <input class="campo_cadastro" type="text" name="" id="input_nome" placeholder="Digite seu nome:">
                    <label class="fontRed boldMedio descricao" for="input_email">Email</label>
                    <input class="campo_cadastro" type="text" name="" id="input_email" placeholder="Digite seu email:">
                    <label class="fontRed boldMedio descricao" for="select_personagem">Personagem favorito:</label>

                    <select class="campo_cadastro" name="" id="select_personagem">
                        <option value="#" disabled selected>Selecione um personagem</option>
                        <option>Relâmpago McQueen</option>
                        <option>Tom Matter</option>
                        <option>Doc Hudson</option>
                        <option>Sally Rodriguez</option>
                        <option>Francesco Virgolini</option>
                        <option>Cruz Ramirez</option>
                        <option>Ramon</option>
                        <option>Jackson Storm</option>
                    </select>
                    <label class="fontRed boldMedio descricao" for="input_senha">Senha</label>
                    <input class="campo_cadastro" type="password" name="" id="input_senha"
                        placeholder="Digite sua senha:">
                    <label class="fontRed boldMedio descricao" for="input_confirma_senha">Confirme senha:</label>
                    <input class="campo_cadastro" type="password" name="" id="input_confirma_senha"
                        placeholder="Confirme sua senha:">
                </div>
                <button onclick="cadastrar()" class="btn_cadastro btn_padrao descricao fontWhite boldMedio">Criar
                    conta</button>
            </div>
            <div class="cont_login">
                <p class="titulo fontWhite">Bem vindo de volta, corredor!</p>
                <p class="subtitulo fontWhite">Crie uma conta exclusiva para você!</p>
                <img src="https://res.cloudinary.com/dsxiq1hsi/image/upload/v1762818903/img_mate_personagem_l3uktb.png"
                    alt="">
                <button onclick="irLogin()" class="btn_login btn_padrao descricao fontWhite boldMedio">Entre em sua conta</button>

            </div>
        </div>
    </div>
</body>

</html>
<script>

    // Array para armazenar empresas cadastradas para validação de código de ativação 
    function irLogin() {
        window.location = 'login.html'
    }
    function cadastrar() {
        // aguardar();
        var erro = 0
        var erroNome = 0;
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var listaNumeros = [
            0, 1, 2, 3, 4, 5, 6, 7, 8, 9
        ]
        var nomeVar = input_nome.value
        var emailVar = input_email.value
        var senhaVar = input_senha.value
        var confirmacaoSenhaVar = input_confirma_senha.value
        var personagemVar = select_personagem.value
        for (var i = 0; i < 10; i++) {
            var caractereAtual = nomeVar[i];
            if (listaNumeros.includes(caractereAtual)) {
                erroNome++
            }
            erro = erroNome
        }

        var emailTemCaracteres = emailVar.includes('@') && emailVar.includes('.com')

        // Verificando se há algum campo em branco
        if (
            nomeVar == "" ||
            emailVar == "" ||
            senhaVar == "" ||
            confirmacaoSenhaVar == "" ||
            personagemVar == "#"
        ) {
            cardErro.style.display = "block";
            erro++
            mensagem_erro.innerHTML = "Campos em branco! Preeencha todos para prosseguir ";
        } 
        if (erro == 0) {
            // Enviando o valor da nova input
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeServer: nomeVar,
                    emailServer: emailVar,
                    senhaServer: senhaVar,
                    personagemServer: personagemVar
                }),

            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);
                    if (resposta.ok) {
                        cardErro.style.display = "block";
                        mensagem_erro.innerHTML =
                            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";
                        setTimeout(() => {
                            window.location = "login.html";
                        }, "2000");

                        limparFormulario();
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });

            return false;
        }
        setInterval(sumirMensagem, 5000)

    }
    function sumirMensagem() {
        cardErro.style.display = "none";
    }
</script>