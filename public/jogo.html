<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copa Pistão</title>
    <link rel="stylesheet" href="css/jogo.css">
</head>

<body>
    <div id="container">
        <div id="grid">
            <div class="posicao_line1 lines" id="line_1">
                <div class="partesPista partesPistaEsquerdaCFaixa" id="partePista1"></div>
                <div class="partesPista partesPistaMeioCFaixa" id="partePista2"></div>
                <div class="partesPista partesPistaDireitaCFaixa" id="partePista3"></div>
            </div>
            <div class="posicao_line2 lines" id="line_2">
                <div class="partesPista bordaEsquerda" id="partePista4"></div>
                <div class="partesPista" id="partePista5"></div>
                <div class="partesPista bordaDireita" id="partePista6"></div>
            </div>
            <div class="posicao_line3 lines" id="line_3">
                <div class="partesPista partesPistaEsquerdaCFaixa" id="partePista7"></div>
                <div class="partesPista partesPistaMeioCFaixa" id="partePista8"></div>
                <div class="partesPista partesPistaDireitaCFaixa" id="partePista9"></div>
            </div>
            <div class="posicao_line4 lines" id="line_4">
                <div class="partesPista bordaEsquerda" id="partePista10"></div>
                <div class="partesPista" id="partePista11"></div>
                <div class="partesPista bordaDireita" id="partePista12"></div>
            </div>
            <div class="posicao_line5 lines" id="line_5">
                <div class="partesPista partesPistaEsquerdaCFaixa" id="partePista13"></div>
                <div class="partesPista partesPistaMeioCFaixa" id="partePista14"></div>
                <div class="partesPista partesPistaDireitaCFaixa" id="partePista15"></div>
            </div>
            <div class="posicao_line6 lines" id="line_6">
                <div class="partesPista bordaEsquerda" id="partePista16"></div>
                <div class="partesPista" id="partePista17"></div>
                <div class="partesPista bordaDireita" id="partePista18"></div>
            </div>
            <div class="posicao_line7 lines" id="line_7">
                <div class="partesPista partesPistaEsquerdaCFaixa" id="partePista19"></div>
                <div class="partesPista partesPistaMeioCFaixa" id="partePista20"></div>
                <div class="partesPista partesPistaDireitaCFaixa" id="partePista21"></div>
            </div>
            <div class="posicao_line8 lines" id="line_8">
                <div class="partesPista bordaEsquerda" id="partePista22"></div>
                <div class="partesPista" id="partePista23"></div>
                <div class="partesPista bordaDireita" id="partePista24"></div>
            </div>

            <div class="linha_chegada lines" style="display: none;" id="linha_chegada">
                <div class="partesPista partesPistaEsquerdaCFaixa" id="partePista22"></div>
                <div class="partesPista partesPistaMeioCFaixa" id="partePista23"></div>
                <div class="partesPista partesPistaDireitaCFaixa" id="partePista24"></div>
            </div>

            <div class="arredores" id="arredor1"></div>
            <div class="arredores" id="arredor2"></div>
            <div class="arredores" id="arredor3"></div>
            <div class="arredores" id="arredor4"></div>
            <div class="arredores" id="arredor5"></div>
            <div class="arredores" id="arredor6"></div>
            <div class="arredores" id="arredor7"></div>
            <div class="arredores" id="arredor8"></div>
            <div class="arredores" id="arredor9"></div>
            <div class="arredores" id="arredor10"></div>
            <div class="arredores" id="arredor11"></div>
            <div class="arredores" id="arredor12"></div>
            <div class="arredores" id="arredor13"></div>
            <div class="arredores" id="arredor14"></div>
            <div class="arredores" id="arredor15"></div>
            <div class="arredores" id="arredor16"></div>
            <img name="1" id="cacto" src="assets/img/img_cacto.jpg" alt="">
            <img name="2" id="img_bola_feno" src="assets/img/img_bola_de_feno.png" alt="">
            <img id="img" src="assets/img/mcqueen.png" alt="">
        </div>
    </div>
</body>

</html>

<script>


    var colunaCarro = 3
    var linhaCarro = 6

    var obstaculo = [
        document.getElementById('cacto'),
        document.getElementById('img_bola_feno')
    ]


    document.getElementById('img').style.gridRow = linhaCarro
    document.getElementById('img').style.gridColumn = colunaCarro;

    var colunaObstaculo = 0
    var linhaObstaculo = 0
    var colunaAleatoria = 0
    var contagemLinhas = 0
    var linhaAtual = 0
    var trocaDeLinha = 1
    var intervaloChamada = 1025
    var timeOutColisao = 0

    setTimeout(() => {
        chamarObstaculo()
        movimentoPista()
    }, intervaloChamada);

    // FUNÇÃO QUE CHAMA O OBSTÁCULO VERIFICANDO A LINHA 
    function chamarObstaculo() {
        timeOutColisao = setTimeout(verificarColisao, 1)
        if (linhaAtual == 0) {
            if (contagemLinhas > 0) {
                obstaculo[indiceObstaculo].style.display = 'none'
            }
            sortearObstaculo()
        } else {
            mudarLinha(indiceObstaculo, colunaAleatoria)
        }
        timeOutColisao = setTimeout(verificarColisao, 1)
        timeOutChamarObstaculo = setTimeout(() => {
            chamarObstaculo()
        }, intervaloChamada);
    }

    function sortearObstaculo() {
        indiceObstaculo = Math.floor(Math.random() * 2)
        console.log("Indice:", indiceObstaculo);
        console.log(obstaculo[indiceObstaculo]);

        sortearColuna()
    }
    // FUNÇÃO QUE GERA UMA COLUNA ALEATÓRIA PARA O OBSTÁCULO
    function sortearColuna() {
        colunaAleatoria = Math.floor(Math.random() * 3) + 2
        colunaObstaculo = colunaAleatoria

        mudarLinha(indiceObstaculo, colunaAleatoria)
    }

    function mudarLinha(indiceObstaculo, colunaAleatoria) {
        timeOutColisao = setTimeout(verificarColisao, 1)
        obstaculo[indiceObstaculo].style.gridColumn = colunaAleatoria

        linhaAtual++
        linhaObstaculo = linhaAtual

        if (linhaAtual < 8) {
            obstaculo[indiceObstaculo].style.gridRow = linhaAtual
            contagemLinhas++
        } else {
            obstaculo[indiceObstaculo].style.gridRow = linhaAtual
            linhaAtual = 0
            contagemLinhas++
        }

        // CONTROLADOR DE VELOCIDADE

        
        if (contagemLinhas >= 0) {
            intervaloChamada -= 5
            console.log(intervaloChamada);
        } else if (contagemLinhas >= 20 && contagemLinhas <= 40) {
            intervaloChamada -= 5
            console.log(intervaloChamada);

        } else if (contagemLinhas > 40 && contagemLinhas <= 60) {
            intervaloChamada -= 5
            console.log(intervaloChamada);

        } else if (contagemLinhas > 60 && contagemLinhas <= 80) {
            intervaloChamada -= 5
            console.log(intervaloChamada);
        } else if (contagemLinhas > 80 && contagemLinhas <= 100) {
            intervaloChamada -= 5
            console.log(intervaloChamada);
        } else if (contagemLinhas > 100 && contagemLinhas <= 120) {
            intervaloChamada -= 5
            console.log(intervaloChamada);

        } else if (contagemLinhas > 120 && contagemLinhas <= 140) {
            intervaloChamada -= 5
            console.log(intervaloChamada);
        } else if (contagemLinhas > 140 && contagemLinhas <= 160) {
            intervaloChamada -= 5
            console.log(intervaloChamada);
        } else if (contagemLinhas > 160 && contagemLinhas <= 200) {
            intervaloChamada -= 5
            console.log(intervaloChamada);
        } else if (contagemLinhas > 200) {
            intervaloChamada = 25
            console.log(intervaloChamada);
        }
        obstaculo[indiceObstaculo].style.display = 'flex'
        timeOutColisao = setTimeout(verificarColisao, 1)

        console.log(contagemLinhas);
    }
    function verificarColisao() {
        console.log('Verificar:');

        if (indiceObstaculo == 0 && linhaCarro == linhaObstaculo && colunaCarro == colunaObstaculo) {
            alert('Bateu')
            clearTimeout(timeOutColisao)
            clearTimeout(timeOutChamarObstaculo)
            clearTimeout(timeOutMovimento)
        } else if (indiceObstaculo == 1 && linhaCarro == linhaObstaculo && colunaCarro == colunaObstaculo) {
            contagemLinhas = 0
            intervaloChamada = 1025
        }
    }
    function movimentoPista() {
        timeOutColisao = setTimeout(verificarColisao, 1)

        if (trocaDeLinha == 0) {
            document.getElementById('line_1').classList.remove('posicao_line2')
            document.getElementById('line_2').classList.remove('posicao_line1')
            document.getElementById('line_3').classList.remove('posicao_line4')
            document.getElementById('line_4').classList.remove('posicao_line3')
            document.getElementById('line_5').classList.remove('posicao_line6')
            document.getElementById('line_6').classList.remove('posicao_line5')
            document.getElementById('line_7').classList.remove('posicao_line8')
            document.getElementById('line_8').classList.remove('posicao_line7')

            document.getElementById('line_1').classList.add('posicao_line1')
            document.getElementById('line_2').classList.add('posicao_line2')
            document.getElementById('line_3').classList.add('posicao_line3')
            document.getElementById('line_4').classList.add('posicao_line4')
            document.getElementById('line_5').classList.add('posicao_line5')
            document.getElementById('line_6').classList.add('posicao_line6')
            document.getElementById('line_7').classList.add('posicao_line7')
            document.getElementById('line_8').classList.add('posicao_line8')
            trocaDeLinha = 1
        } else {
            trocaDeLinha = 0
            document.getElementById('line_1').classList.remove('posicao_line1')
            document.getElementById('line_2').classList.remove('posicao_line2')
            document.getElementById('line_3').classList.remove('posicao_line3')
            document.getElementById('line_4').classList.remove('posicao_line4')
            document.getElementById('line_5').classList.remove('posicao_line5')
            document.getElementById('line_6').classList.remove('posicao_line6')
            document.getElementById('line_7').classList.remove('posicao_line7')
            document.getElementById('line_8').classList.remove('posicao_line8')

            document.getElementById('line_1').classList.add('posicao_line2')
            document.getElementById('line_2').classList.add('posicao_line1')
            document.getElementById('line_3').classList.add('posicao_line4')
            document.getElementById('line_4').classList.add('posicao_line3')
            document.getElementById('line_5').classList.add('posicao_line6')
            document.getElementById('line_6').classList.add('posicao_line5')
            document.getElementById('line_7').classList.add('posicao_line8')
            document.getElementById('line_8').classList.add('posicao_line7')
        }
        timeOutMovimento = setTimeout(() => {
            movimentoPista()
        }, intervaloChamada);
    }





    document.addEventListener('keydown', function (event) {
        if (event.key == 'ArrowLeft') {
            if (document.getElementById('img').style.gridColumn == 3) {
                colunaCarro = 2

                document.getElementById('img').style.gridColumn = colunaCarro
            } else if (document.getElementById('img').style.gridColumn == 4) {
                colunaCarro = 3
                document.getElementById('img').style.gridColumn = colunaCarro

            } else {
                console.log("Cai no else do left");
            }
            timeOutColisao = setTimeout(verificarColisao, 1)


        }
        if (event.key == 'ArrowRight') {
            if (document.getElementById('img').style.gridColumn == 3) {
                colunaCarro = 4
                document.getElementById('img').style.gridColumn = colunaCarro

            } else if (document.getElementById('img').style.gridColumn == 2) {
                colunaCarro = 3
                document.getElementById('img').style.gridColumn = colunaCarro

            } else {
                console.log("Cai no else do right");
            }
            timeOutColisao = setTimeout(verificarColisao, 1)


        }
    })
</script>